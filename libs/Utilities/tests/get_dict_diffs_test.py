import unittest
from Utilities.dict_management import get_dict_diffs

class Test(unittest.TestCase):
    
    def test1(self):
        dict1 = {'KBankHeader': {'funcNm': 'MDWCommonTransferK2K', 'rqUID': '50920191113_sfbrl9pp1lrzp7nukerf3ki645809213', 'rsAppId': '25703', 'rsUID': 'd0ad88c5-4754-4c47-a1bc-52db1efe5407', 'rsDt': '2019-11-13T10:29:43.667+07:00', 'statusCode': '00', 'corrID': '400e29b41d4a716446655440', 'reqAuthUserId': 'KMP00001', 'reqAuthLevel': '003'}, 'MDWCommonTransferK2K': {'amt': 1030.5, 'feeAmt': 1.5, 'fromAcctID': '0012000030', 'fromAcctBranch': '0001', 'fromAcctProductCode': '210201001', 'fromAcctEngName': '', 'fromAcctThName': '', 'fromOutStandBal': 300523007.81, 'fromAvailBal': 300523007.81, 'toAcctID': '0012000049', 'toAcctBranch': '0001', 'toAcctProductCode': '210201001', 'toAcctEngName': '', 'toAcctThName': '', 'toAcctOutStandBal': 90111157619.19, 'toAvailBal': 90111157619.19, 'extErrCode': ''}}
        dict2 = {'KBankHeader': {'funcNm': 'MDWCommonTransferK2K', 'rqUID': '509_20191016_00000000001434', 'rsAppId': '25703', 'rsUID': 'c5332a4c-8064-4387-b4b8-fbda02789e82', 'rsDt': '2019-10-16T16:27:42.854+07:00', 'statusCode': '00', 'corrID': '400e29b41d4a716446655440', 'reqAuthUserId': 'KMP00001', 'reqAuthLevel': '003'}, 'MDWCommonTransferK2K': {'amt': 1030.5, 'feeAmt': 1.5, 'fromAcctID': '0012000030', 'fromAcctBranch': '0001', 'fromAcctProductCode': '210201001', 'fromAcctEngName': '', 'fromAcctThName': '', 'fromOutStandBal': 300532295.81, 'fromAvailBal': 300532295.81, 'toAcctID': '0012000049', 'toAcctBranch': '0001', 'toAcctProductCode': '210201001', 'toAcctEngName': '', 'toAcctThName': '', 'toAcctOutStandBal': 90111148344.69, 'toAvailBal': 90111148344.69, 'extErrCode': ''}}
        result = get_dict_diffs(dict1, dict2)
        expect = [('change', 'KBankHeader.rqUID', ('509_20191016_00000000001434', '50920191113_sfbrl9pp1lrzp7nukerf3ki645809213')), ('change', 'KBankHeader.rsUID', ('c5332a4c-8064-4387-b4b8-fbda02789e82', 'd0ad88c5-4754-4c47-a1bc-52db1efe5407')), ('change', 'KBankHeader.rsDt', ('2019-10-16T16:27:42.854+07:00', '2019-11-13T10:29:43.667+07:00')), ('change', 'MDWCommonTransferK2K.fromOutStandBal', (300532295.81, 300523007.81)), ('change', 'MDWCommonTransferK2K.fromAvailBal', (300532295.81, 300523007.81)), ('change', 'MDWCommonTransferK2K.toAcctOutStandBal', (90111148344.69, 90111157619.19)), ('change', 'MDWCommonTransferK2K.toAvailBal', (90111148344.69, 90111157619.19))]
        assert result == expect

    def test2(self):
        dict1 = {'KBankHeader': {'funcNm': 'MDWCommonTransferK2K', 'rqUID': '50920191113_sfbrl9pp1lrzp7nukerf3ki645809213', 'rsAppId': '25703', 'rsUID': 'd0ad88c5-4754-4c47-a1bc-52db1efe5407', 'rsDt': '2019-11-13T10:29:43.667+07:00', 'statusCode': '00', 'corrID': '400e29b41d4a716446655440', 'reqAuthUserId': 'KMP00001', 'reqAuthLevel': '003'}, 'MDWCommonTransferK2K': {'amt': 1030.5, 'feeAmt': 1.5, 'fromAcctID': '0012000030', 'fromAcctBranch': '0001', 'fromAcctProductCode': '210201001', 'fromAcctEngName': '', 'fromAcctThName': '', 'fromOutStandBal': 300523007.81, 'fromAvailBal': 300523007.81, 'toAcctID': '0012000049', 'toAcctBranch': '0001', 'toAcctProductCode': '210201001', 'toAcctEngName': '', 'toAcctThName': '', 'toAcctOutStandBal': 90111157619.19, 'toAvailBal': 90111157619.19, 'extErrCode': ''}}
        dict2 = {'KBankHeader': {'funcNm': 'MDWCommonTransferK2K', 'rsAppId': '25703', 'rsUID': 'c5332a4c-8064-4387-b4b8-fbda02789e82', 'rsDt': '2019-10-16T16:27:42.854+07:00', 'statusCode': '00', 'corrID': '400e29b41d4a716446655440', 'reqAuthUserId': 'KMP00001', 'reqAuthLevel': '003'}, 'MDWCommonTransferK2K': {'amt': 1030.5, 'feeAmt': 1.5, 'fromAcctID': '0012000030', 'fromAcctBranch': '0001', 'fromAcctProductCode': '210201001', 'fromAcctEngName': '', 'fromAcctThName': '', 'fromOutStandBal': 300532295.81, 'fromAvailBal': 300532295.81, 'toAcctID': '0012000049', 'toAcctBranch': '0001', 'toAcctProductCode': '210201001', 'toAcctEngName': '', 'toAcctThName': '', 'toAcctOutStandBal': 90111148344.69, 'toAvailBal': 90111148344.69, 'extErrCode': ''}}
        result = get_dict_diffs(dict1, dict2)
        expect = [('change', 'KBankHeader.rsUID', ('c5332a4c-8064-4387-b4b8-fbda02789e82', 'd0ad88c5-4754-4c47-a1bc-52db1efe5407')), ('change', 'KBankHeader.rsDt', ('2019-10-16T16:27:42.854+07:00', '2019-11-13T10:29:43.667+07:00')), ('add', 'KBankHeader', [('rqUID', '50920191113_sfbrl9pp1lrzp7nukerf3ki645809213')]), ('change', 'MDWCommonTransferK2K.fromOutStandBal', (300532295.81, 300523007.81)), ('change', 'MDWCommonTransferK2K.fromAvailBal', (300532295.81, 300523007.81)), ('change', 'MDWCommonTransferK2K.toAcctOutStandBal', (90111148344.69, 90111157619.19)), ('change', 'MDWCommonTransferK2K.toAvailBal', (90111148344.69, 90111157619.19))]
        assert result == expect

    def test3(self):
        dict1 = {'KBankHeader': {'funcNm': 'MDWCommonTransferK2K', 'rsAppId': '25703', 'rsUID': 'd0ad88c5-4754-4c47-a1bc-52db1efe5407', 'rsDt': '2019-11-13T10:29:43.667+07:00', 'statusCode': '00', 'corrID': '400e29b41d4a716446655440', 'reqAuthUserId': 'KMP00001', 'reqAuthLevel': '003'}, 'MDWCommonTransferK2K': {'amt': 1030.5, 'feeAmt': 1.5, 'fromAcctID': '0012000030', 'fromAcctBranch': '0001', 'fromAcctProductCode': '210201001', 'fromAcctEngName': '', 'fromAcctThName': '', 'fromOutStandBal': 300523007.81, 'fromAvailBal': 300523007.81, 'toAcctID': '0012000049', 'toAcctBranch': '0001', 'toAcctProductCode': '210201001', 'toAcctEngName': '', 'toAcctThName': '', 'toAcctOutStandBal': 90111157619.19, 'toAvailBal': 90111157619.19, 'extErrCode': ''}}
        dict2 = {'KBankHeader': {'funcNm': 'MDWCommonTransferK2K', 'rqUID': '50920191113_sfbrl9pp1lrzp7nukerf3ki645809213', 'rsAppId': '25703', 'rsUID': 'd0ad88c5-4754-4c47-a1bc-52db1efe5407', 'rsDt': '2019-11-13T10:29:43.667+07:00', 'statusCode': '00', 'corrID': '400e29b41d4a716446655440', 'reqAuthUserId': 'KMP00001', 'reqAuthLevel': '003'}, 'MDWCommonTransferK2K': {'amt': 1030.5, 'feeAmt': 1.5, 'fromAcctID': '0012000030', 'fromAcctBranch': '0001', 'fromAcctProductCode': '210201001', 'fromAcctEngName': '', 'fromAcctThName': '', 'fromOutStandBal': 300523007.81, 'fromAvailBal': 300523007.81, 'toAcctID': '0012000049', 'toAcctBranch': '0001', 'toAcctProductCode': '210201001', 'toAcctEngName': '', 'toAcctThName': '', 'toAcctOutStandBal': 90111157619.19, 'toAvailBal': 90111157619.19, 'extErrCode': ''}}
        result = get_dict_diffs(dict1, dict2)
        expect = [('remove', 'KBankHeader', [('rqUID', '50920191113_sfbrl9pp1lrzp7nukerf3ki645809213')])]
        assert result == expect

    def test4(self):
        dict1 = {'kbankHeader': {'authLevel': '[IGNORES]', 'authUserId': '[IGNORES]', 'corrID': '[IGNORES]', 'errors': [{'errorAppAbbrv': 'CSM', 'errorAppId': '780', 'errorCode': '30195', 'errorDesc': 'Invalid input format - must not be empty', 'errorSeverity': '00'}], 'funcNm': '', 'rqUID': '509_20190611_000000000000102', 'rsAppId': '780', 'rsDt': '[IGNORES]', 'rsUID': '[IGNORES]', 'statusCode': '01'}}
        dict2 = {'kbankHeader': {'funcNm': '', 'rqUID': '509_20190611_000000000000102', 'rsAppId': '780', 'rsUID': '780_20200623_dfe4dcafac1e421d5e2214886c767603', 'rsDt': '2020-06-23T13:36:57.392+07:00', 'statusCode': '01', 'errors': [{'errorAppId': 'ignore', 'errorAppAbbrv': 'ignore', 'errorCode': '30195', 'errorDesc': 'Invalid input format - must not be empty', 'errorSeverity': '11'}], 'corrID': '', 'authUserId': None, 'authLevel': None}}
        ignore_keys = ['kbankHeader.rsUID', 'kbankHeader.rsDt', ['kbankHeader', 'errors', 0, 'errorAppId'], ['kbankHeader', 'errors', 0, 'errorAppAbbrv'], 'kbankHeader.corrID', 'kbankHeader.authUserId', 'kbankHeader.authLevel']
        result = get_dict_diffs(dict1, dict2, ignore_keys)
        expect = [('change', ['kbankHeader', 'errors', 0, 'errorSeverity'], ('11', '00'))]
        assert result == expect
